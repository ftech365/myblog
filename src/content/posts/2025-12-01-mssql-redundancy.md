---
title: "SQL Server 冗長構成の全パターン比較 — 構築技術・コスト・選定指針まで"
description: "Always On AG・FCIなど主要な冗長構成を網羅的に比較。構築に必要なスキル、ライセンスコスト、ユースケース別の選定指針まで実務目線でまとめた。"
pubDate: 2025-12-01
tags: ["SQL Server", "冗長構成", "HA", "インフラ"]
category: "SQL Server"
draft: false
---

## はじめに

SQL Server（MSSQL）の冗長構成は選択肢が多く、それぞれ前提条件・コスト・運用負荷が大きく異なる。「とりあえず Always On にしておけ」という判断では、ライセンスコストの無駄遣いや、要件に合わない構成を引いてしまうリスクがある。

本記事では実務経験者を対象に、主要な冗長構成を横断的に比較し、構築に必要なスキルセット・ライセンス観点・選定指針まで一気通貫で整理する。

---

## SQL Server 冗長構成の全体マップ

SQL Server の冗長構成は大きく **インスタンスレベル** と **データベースレベル** に分類できる。

```
SQL Server 冗長構成
├── インスタンスレベル
│   └── FCI（Failover Cluster Instance）
│           └── ストレージ共有型のHA
├── データベースレベル
│   ├── Always On AG（Availability Groups）
│   │       └── 最も機能が豊富なHA/DR構成
│   ├── データベースミラーリング ※非推奨（SQL 2019で削除）
│   └── ログ配布（Log Shipping）
│           └── シンプルで低コストなDR構成
└── クラウド／ハイブリッド
    └── Azure SQL Managed Instance / Always On + Azure
```

---

## 各構成の詳細比較

### 1. Always On Availability Groups（AG）

SQL Server 2012以降で利用可能な、現在の**推奨HA/DR構成**。データベース単位でレプリカを持ち、同期/非同期レプリケーションの混在も可能。

**アーキテクチャの特徴**

- プライマリレプリカ1台 + セカンダリレプリカ最大8台（SQL 2022）
- Windows Server Failover Cluster（WSFC）
- 同期コミットモード：RPO=0（データ損失なし）、RTO=秒単位
- 非同期コミットモード：RPO=秒〜分、地理的に離れたDRサイト向け
- セカンダリへの読み取りオフロード（Read-Only Routing）が可能

**ユースケース**

```
本番DBの高可用性構成（同期）
        +
地理的に離れたDRサイト（非同期）
        +
レポーティング用のセカンダリ（読み取りオフロード）
```

**制約・注意点**

- Enterprise Edition が必要（Standard は Basic AG として制限付きで利用可能）
- Basic AG はデータベース1つ・セカンダリ1台に制限
- WSFCのクォーラム設計が必要（奇数台 or クラウド監視の設定）
- AG リスナーのDNS/ネットワーク設計が必要

---

### 2. Failover Cluster Instance（FCI）

Windowsクラスタリング（WSFC）とSQL Serverを組み合わせた**インスタンスレベルのHA構成**。SQL Serverのプロセス自体をフェールオーバーさせる。

**アーキテクチャの特徴**

- クラスタノード間でSQL Serverのインスタンスを共有
- ストレージは共有ディスク（SAN/iSCSI）またはStorage Spaces Direct（S2D）
- クライアントからは仮想ネットワーク名（VNN）でアクセスするため接続文字列の変更不要
- フェールオーバー時間は1〜3分程度（AGより長い）

**ユースケース**

- OSやSQL Serverのバグ・パッチ適用時の無停止メンテナンス
- ハードウェア障害への対応
- AGと組み合わせてFCI+AGの複合構成も可能

**制約・注意点**

- 共有ストレージが単一障害点になりやすい（S2Dで解消可能）
- AGに比べてフェールオーバーが低速
- ストレージのコストが高くなりやすい
- Standard/Enterpriseどちらでも利用可能（2ノードまで）

---

### 3. ログ配布（Log Shipping）

トランザクションログを定期的にバックアップ・転送・リストアすることで冗長性を確保する**最もシンプルなDR構成**。

**アーキテクチャの特徴**

- プライマリ → セカンダリへのログバックアップジョブを定期実行
- RPOはログバックアップ間隔に依存（デフォルト15分〜）
- セカンダリはリストア中のため通常は読み取り不可（スタンバイモードで読み取りのみ可）
- 転送手段はSQLエージェントジョブ + ファイル共有

**ユースケース**

- コストを抑えたDRサイト構成
- バージョンアップ時の移行手段
- AGの前段として簡易検証に使う

**制約・注意点**

- フェールオーバーは手動が基本（自動化には追加スクリプトが必要）
- 遅延（レイテンシ）がRPOに直結する
- Standard/Enterpriseどちらでも利用可能
- AGが使える環境なら基本的にAGを優先すべき

---

## 機能・要件比較表

| 項目 | Always On AG | FCI | ログ配布 |
|---|---|---|---|
| **対象スコープ** | データベース単位 | インスタンス単位 | データベース単位 |
| **RPO（目標復旧時点）** | 0（同期時） | 0 | 分単位 |
| **RTO（目標復旧時間）** | 秒〜数十秒 | 1〜3分 | 数十分〜 |
| **自動フェールオーバー** | ✅ | ✅ | ❌（手動） |
| **読み取りオフロード** | ✅ | ❌ | △（スタンバイのみ） |
| **共有ストレージ不要** | ✅ | ❌（S2Dを除く） | ✅ |
| **必要エディション** | Enterprise推奨 | Standard以上 | Standard以上 |
| **構築難易度** | 高 | 中 | 低 |
| **運用負荷** | 中 | 中 | 低 |

---

## ライセンス・コスト観点

SQL Server のライセンスはHA/DR構成と密接に関係しており、見落としがちなコスト要因になる。

### エディション別の機能制限

| 機能 | Standard | Enterprise |
|---|---|---|
| Always On AG（フル機能） | ❌ | ✅ |
| Always On Basic AG | ✅（DB1つ・レプリカ1台） | ✅ |
| FCI | ✅（2ノードまで） | ✅（最大制限なし） |
| ログ配布 | ✅ | ✅ |
| 読み取りオフロード（AG） | ❌ | ✅ |

### ライセンスの「HA特例」

**重要**: Microsoftのライセンス条項では、パッシブなフェールオーバーサーバー（待機系）に対してはライセンスが免除される場合がある。

ただし以下の条件を満たす必要がある:

- セカンダリが **完全にパッシブ** であること（読み取りクエリを処理していない）
- ソフトウェアアシュアランス（SA）が有効であること
- 同時実行インスタンス数が本番ライセンス数を超えないこと

読み取りオフロードを有効にした瞬間に待機系もライセンスが必要になるため、コスト試算時は必ず確認すること。

---

## どの構成を選ぶべきか — 選定指針

### 判断フローチャート

```
RPO = 0 が必要か？
├─ YES → 自動フェールオーバーが必要か？
│         ├─ YES → Always On AG（同期コミット）
│         └─ NO  → FCI（シンプルな構成でよい場合）
└─ NO  → コストを最優先したいか？
          ├─ YES → ログ配布（Standard でも可）
          └─ NO  → Always On AG（非同期 + 同期の混在構成）
```

### ユースケース別の推奨構成

**ミッションクリティカルな基幹システム**
→ Always On AG（同期コミット、Enterprise Edition）
フェールオーバーの速度とデータ損失ゼロを優先。読み取りオフロードも活用してレポート系の負荷を分離する。

**コスト重視の中規模システム**
→ Always On Basic AG または FCI（Standard Edition）
Basic AGでもRPO=0・自動フェールオーバーは実現できる。ただしDB1つ・レプリカ1台の制限を考慮する。

**地理的に離れたDRサイトが必要**
→ Always On AG（非同期コミット）をプライマリAGに追加
同期サイト内はAG同期コミット、DR拠点は非同期コミットのレプリカを追加する。

**予算が限られているDR構成**
→ ログ配布（Standard Edition）
構築・運用コストが最も低い。RPOが分単位でよく、フェールオーバーが手動でも許容できる環境向け。

---

## まとめ

SQL Server の冗長構成は Always On AG が現在の標準解だが、コスト・RPO/RTO要件・運用体制によって最適解は変わる。特にライセンスの「HA特例」の条件は見落とされやすく、読み取りオフロードを有効にするだけで追加コストが発生する点には注意が必要だ。

構成選定の際は本記事の比較表と判断フローを参考に、まず要件を整理した上で技術選定を行うことを推奨する。

---

## 参考リンク

- [Microsoft Docs — Always On 可用性グループ](https://learn.microsoft.com/ja-jp/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server)
- [Microsoft Docs — フェールオーバークラスターインスタンス](https://learn.microsoft.com/ja-jp/sql/sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server)
- [SQL Server ライセンスガイド](https://www.microsoft.com/ja-jp/sql-server/sql-server-2022-comparison)
